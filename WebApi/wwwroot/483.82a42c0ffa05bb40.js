"use strict";(self.webpackChunkClient=self.webpackChunkClient||[]).push([[483],{6483:(ce,b,c)=>{c.r(b),c.d(b,{CheckoutModule:()=>se});var a=c(95),f=c(8180),e=c(4769),g=c(823),C=c(5516),w=c(9862);let y=(()=>{class i{constructor(t){this.httpClient=t,this.baseUrl=C.N.baseUrl}getDeliveryMethods(){return this.httpClient.get(this.baseUrl+"/deliveryMethods")}createOrder(t){return this.httpClient.post(this.baseUrl+"/orders",t)}createPaymentIntent(t){return this.httpClient.post(this.baseUrl+"/payments",t)}static#e=this.\u0275fac=function(n){return new(n||i)(e.LFG(w.eN))};static#t=this.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var u=c(2999),A=c(8639),l=c(3971),p=c(6814);function E(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"li",4)(1,"div",5)(2,"button",6),e.NdJ("click",function(){const s=e.CHM(t).index,d=e.oxw();return e.KtG(d.activeStep(s))}),e._uU(3),e.qZA()()()}if(2&i){const t=o.$implicit,n=o.index,r=e.oxw();e.xp6(2),e.ekj("active",r.selectedIndex===n),e.Q6J("disabled",r.linear),e.xp6(1),e.hij(" ",t.label," ")}}function J(i,o){if(1&i&&(e.TgZ(0,"div"),e.GkF(1,7),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngTemplateOutlet",t.selected.content)}}let P=(()=>{class i extends l.B8{constructor(){super(...arguments),this.linearModeSelected=!0}ngOnInit(){this.linear=this.linearModeSelected}activeStep(t){this.selectedIndex=t}static#e=this.\u0275fac=function(){let t;return function(r){return(t||(t=e.n5z(i)))(r||i)}}();static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-stepper"]],inputs:{linearModeSelected:"linearModeSelected"},features:[e._Bn([{provide:l.B8,useExisting:i}]),e.qOj],decls:4,vars:2,consts:[[1,"container"],[1,"nav","nav-pills","nav-justified"],["class","nav-item",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"nav-item"],[1,"d-grid"],[1,"nav-link","py-3","text-uppercase","fw-bold",3,"disabled","click"],[3,"ngTemplateOutlet"]],template:function(n,r){1&n&&(e.TgZ(0,"div",0)(1,"ul",1),e.YNc(2,E,4,4,"li",2),e.qZA(),e.YNc(3,J,2,1,"div",3),e.qZA()),2&n&&(e.xp6(2),e.Q6J("ngForOf",r.steps),e.xp6(1),e.Q6J("ngIf",r.selected))},dependencies:[p.sg,p.O5,p.tP],styles:[".nav-link[_ngcontent-%COMP%]{background-color:#e9ecef;border-radius:0;color:#333}"]})}return i})();var N=c(6448),k=c(2425),Z=c(4377);let q=(()=>{class i{constructor(t,n,r){this.fb=t,this.accountService=n,this.toatrService=r}ngOnInit(){this.accountService.loadCurrentAuth().pipe((0,f.q)(1)).subscribe(t=>this.addressForm.setValue(t.address))}updateUserAddress(){this.accountService.updateUserAddress(this.addressForm.value).pipe((0,f.q)(1)).subscribe({complete:()=>{this.toatrService.success("Address has been saved successfully"),this.addressForm.reset(this.addressForm.value)}})}static#e=this.\u0275fac=function(n){return new(n||i)(e.Y36(a.qu),e.Y36(N.B),e.Y36(k._W))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-checkout-address"]],inputs:{addressForm:"addressForm"},decls:14,vars:6,consts:[[1,"mt-4","mb-3","d-flex","justify-content-between","align-items-center"],["type","button",1,"btn","btn-outline-success",3,"disabled","click"],[1,"row","row-cols-2",3,"formGroup"],[1,"col"],["label","Street",3,"control"],["label","City",3,"control"],["label","State",3,"control"],["label","Zipcode",3,"control"]],template:function(n,r){1&n&&(e.TgZ(0,"div",0)(1,"h4"),e._uU(2,"Shipping address"),e.qZA(),e.TgZ(3,"button",1),e.NdJ("click",function(){return r.updateUserAddress()}),e._uU(4,"Set as default address"),e.qZA()(),e.TgZ(5,"form",2)(6,"div",3),e._UZ(7,"app-form-input",4),e.qZA(),e.TgZ(8,"div",3),e._UZ(9,"app-form-input",5),e.qZA(),e.TgZ(10,"div",3),e._UZ(11,"app-form-input",6),e.qZA(),e.TgZ(12,"div",3),e._UZ(13,"app-form-input",7),e.qZA()()),2&n&&(e.xp6(3),e.Q6J("disabled",r.addressForm.pristine||r.addressForm.invalid),e.xp6(2),e.Q6J("formGroup",r.addressForm),e.xp6(2),e.Q6J("control",r.addressForm.controls.street),e.xp6(2),e.Q6J("control",r.addressForm.controls.city),e.xp6(2),e.Q6J("control",r.addressForm.controls.state),e.xp6(2),e.Q6J("control",r.addressForm.controls.zipcode))},dependencies:[Z.s,a._Y,a.JL,a.sg]})}return i})();function M(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",3)(1,"input",4),e.NdJ("change",function(){const s=e.CHM(t).$implicit,d=e.oxw();return e.KtG(d.updateShippingPrice(s))}),e.qZA(),e.TgZ(2,"label",5),e._uU(3),e.ALo(4,"currency"),e.TgZ(5,"p",6),e._uU(6),e.qZA()()()}if(2&i){const t=o.$implicit;e.xp6(1),e.Q6J("value",t.id)("id",t.id),e.xp6(1),e.Q6J("for",t.id),e.xp6(1),e.AsE(" ",t.name," - ",e.lcZ(4,6,t.price)," "),e.xp6(3),e.Oqu(t.description)}}let O=(()=>{class i{constructor(t){this.checkoutService=t,this.deliveryMethods=[],this.deliveryChanged=new e.vpe}ngOnInit(){this.checkoutService.getDeliveryMethods().subscribe(t=>this.deliveryMethods=t)}updateShippingPrice(t){this.deliveryChanged.emit(t)}static#e=this.\u0275fac=function(n){return new(n||i)(e.Y36(y))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-checkout-delivery"]],inputs:{deliveryForm:"deliveryForm"},outputs:{deliveryChanged:"deliveryChanged"},decls:4,vars:2,consts:[[1,"mt-4","mb-3"],[1,"row","row-cols-2",3,"formGroup"],["class","form-check col",4,"ngFor","ngForOf"],[1,"form-check","col"],["type","radio","name","deliveryMethodId","formControlName","deliveryMethodId",1,"form-check-input",3,"value","id","change"],[1,"form-check-label",3,"for"],[1,"text-muted"]],template:function(n,r){1&n&&(e.TgZ(0,"h4",0),e._uU(1,"Choose your delivery method"),e.qZA(),e.TgZ(2,"form",1),e.YNc(3,M,7,8,"div",2),e.qZA()),2&n&&(e.xp6(2),e.Q6J("formGroup",r.deliveryForm),e.xp6(1),e.Q6J("ngForOf",r.deliveryMethods))},dependencies:[p.sg,a._Y,a.Fj,a._,a.JJ,a.JL,a.sg,a.u,p.H9]})}return i})();var Q=c(9384);let D=(()=>{class i{static#e=this.\u0275fac=function(n){return new(n||i)};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-checkout-review"]],inputs:{basketDetails:"basketDetails"},decls:2,vars:1,consts:[[1,"mt-4"],[3,"basketDetails"]],template:function(n,r){1&n&&(e.TgZ(0,"div",0),e._UZ(1,"app-basket-summary",1),e.qZA()),2&n&&(e.xp6(1),e.Q6J("basketDetails",r.basketDetails))},dependencies:[Q.b]})}return i})();function F(i,o,t,n,r,s,d){try{var h=i[s](d),m=h.value}catch(ae){return void t(ae)}h.done?o(m):Promise.resolve(m).then(n,r)}function S(i){return function(){var o=this,t=arguments;return new Promise(function(n,r){var s=i.apply(o,t);function d(m){F(s,n,r,d,h,"next",m)}function h(m){F(s,n,r,d,h,"throw",m)}d(void 0)})}}var x="https://js.stripe.com/v3",G=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,T="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",v=null,_=Promise.resolve().then(function(){return o=null,null!==v||(v=new Promise(function(t,n){if(typeof window>"u"||typeof document>"u")t(null);else if(window.Stripe&&o&&console.warn(T),window.Stripe)t(window.Stripe);else try{var r=function(){for(var o=document.querySelectorAll('script[src^="'.concat(x,'"]')),t=0;t<o.length;t++){var n=o[t];if(G.test(n.src))return n}return null}();r&&o?console.warn(T):r||(r=function(o){var t=o&&!o.advancedFraudSignals?"?advancedFraudSignals=false":"",n=document.createElement("script");n.src="".concat(x).concat(t);var r=document.head||document.body;if(!r)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return r.appendChild(n),n}(o)),r.addEventListener("load",function(){window.Stripe?t(window.Stripe):n(new Error("Stripe.js not available"))}),r.addEventListener("error",function(){n(new Error("Failed to load Stripe.js"))})}catch(s){return void n(s)}})),v;var o}),U=!1;_.catch(function(i){U||console.warn(i)});var z=c(6973),V=c(305),$=c(8872);const W=["cardNumber"],K=["cardExpiry"],ee=["cardCvc"];let te=(()=>{class i{constructor(t,n,r,s,d){this.checkoutService=t,this.toastrService=n,this.router=r,this.basketService=s,this.busyService=d,this.stripe=null,this.cardNumberCompleted=!1,this.cardExpiryCompleted=!1,this.cardCvcCompleted=!1}get paymentForm(){return this.orderForm?.controls.paymentForm}get paymentFormValid(){return this.orderForm?.invalid||!this.cardNumberCompleted||!this.cardExpiryCompleted||!this.cardCvcCompleted}ngOnInit(){(function(){for(var o=arguments.length,t=new Array(o),n=0;n<o;n++)t[n]=arguments[n];U=!0;var r=Date.now();return _.then(function(s){return function(o,t,n){if(null===o)return null;var r=o.apply(void 0,t);return function(o,t){!o||!o._registerWrapper||o._registerWrapper({name:"stripe-js",version:"2.1.10",startTime:t})}(r,n),r}(s,t,r)})})(C.N.publishableKey).then(t=>{this.stripe=t;const n=t?.elements();n&&(this.stripeCardNumber=n.create("cardNumber"),this.stripeCardNumber.mount(this.cardNumberElement?.nativeElement),this.stripeCardNumber.on("change",r=>{this.cardNumberError=r.error?.message,this.cardNumberCompleted=r.complete}),this.stripeCardExpiry=n.create("cardExpiry"),this.stripeCardExpiry.mount(this.cardExpiryElement?.nativeElement),this.stripeCardExpiry.on("change",r=>{this.cardExpiryError=r.error?.message,this.cardExpiryCompleted=r.complete}),this.stripeCardCvc=n.create("cardCvc"),this.stripeCardCvc.mount(this.cardCvcElement?.nativeElement),this.stripeCardCvc.on("change",r=>{this.cardCvcCompleted=r.complete}))})}onSubmit(){var t=this;return S(function*(){t.getOrderFromForm(),t.busyService.setBusy();try{yield t.cofirmCardPayment();const r=yield t.createOrder();t.basketService?.clearBasket(),t.toastrService.success("Order is created successfully"),t.router.navigateByUrl("/checkout/success",{state:{orderId:r}})}catch(r){t.toastrService.error(r.message)}finally{t.busyService.setIdel()}})()}cofirmCardPayment(){var t=this;return S(function*(){if(!t.paymentIntent)throw new Error("No payment intent");const n=yield t.stripe?.confirmCardPayment(t.paymentIntent.clientSecret,{payment_method:{card:t.stripeCardNumber,billing_details:{name:t.orderForm?.get("nameOnCard")?.value}}});if(!n?.paymentIntent)throw new Error(n?.error.message)})()}createOrder(){const t=this.getOrderFromForm();return function X(i,o){const t="object"==typeof o;return new Promise((n,r)=>{const s=new V.Hp({next:d=>{n(d),s.unsubscribe()},error:r,complete:()=>{t?n(o.defaultValue):r(new z.K)}});i.subscribe(s)})}(this.checkoutService.createOrder(t))}getOrderFromForm(){return{shippingAddress:this.orderForm?.get("addressForm")?.value,deliveryMethodId:this.orderForm?.get("deliveryForm")?.value?.deliveryMethodId,items:this.basketDetails?.basketProducts.map(t=>({productId:t.productId,quantity:t.quantity}))}}static#e=this.\u0275fac=function(n){return new(n||i)(e.Y36(y),e.Y36(k._W),e.Y36(u.F0),e.Y36(g.v),e.Y36($.z))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-checkout-payment"]],viewQuery:function(n,r){if(1&n&&(e.Gf(W,5),e.Gf(K,5),e.Gf(ee,5)),2&n){let s;e.iGM(s=e.CRH())&&(r.cardNumberElement=s.first),e.iGM(s=e.CRH())&&(r.cardExpiryElement=s.first),e.iGM(s=e.CRH())&&(r.cardCvcElement=s.first)}},inputs:{orderForm:"orderForm",basketDetails:"basketDetails",paymentIntent:"paymentIntent"},decls:33,vars:14,consts:[[1,"mt-4"],["label","Name on card",3,"control"],[1,"row","mb-3"],[1,"col-6"],[1,"form-floating","mb-0"],["type","text","name","formId1",1,"form-control"],["cardNumber",""],["for","formId1"],[1,"col-3"],["cardExpiry",""],["cardCvc",""],[1,"text-danger",2,"font-size",".875em"],[1,"d-flex","justify-content-between"],["cdkStepperPrevious","",1,"btn","btn","btn-outline-primary"],[1,"fa","fa-angle-left","me-1"],["cdkStepperNext","",1,"btn","btn-primary",3,"disabled","click"],[1,"fa","fa-angle-right","ms-1"]],template:function(n,r){1&n&&(e.TgZ(0,"div",0),e._UZ(1,"app-form-input",1),e.TgZ(2,"div",2)(3,"div",3)(4,"div",4),e._UZ(5,"div",5,6),e.TgZ(7,"label",7),e._uU(8,"Card Number"),e.qZA()()(),e.TgZ(9,"div",8)(10,"div",4),e._UZ(11,"div",5,9),e.TgZ(13,"label",7),e._uU(14,"Card Expiry"),e.qZA()()(),e.TgZ(15,"div",8)(16,"div",4),e._UZ(17,"div",5,10),e.TgZ(19,"label",7),e._uU(20,"Card CVC"),e.qZA()()(),e.TgZ(21,"div",11)(22,"div"),e._uU(23),e.qZA(),e.TgZ(24,"div"),e._uU(25),e.qZA()()()(),e.TgZ(26,"div",12)(27,"button",13),e._UZ(28,"i",14),e._uU(29," back to Review"),e.qZA(),e.TgZ(30,"button",15),e.NdJ("click",function(){return r.onSubmit()}),e._uU(31," Submit Your Order "),e._UZ(32,"i",16),e.qZA()()),2&n&&(e.xp6(1),e.Q6J("control",null==r.paymentForm?null:r.paymentForm.controls.nameOnCard),e.xp6(4),e.ekj("is-invalid",r.cardNumberError)("is-valid",r.cardNumberCompleted),e.xp6(6),e.ekj("is-invalid",r.cardExpiryError)("is-valid",r.cardExpiryCompleted),e.xp6(6),e.ekj("is-valid",r.cardCvcCompleted),e.xp6(6),e.Oqu(r.cardNumberError),e.xp6(2),e.Oqu(r.cardExpiryError),e.xp6(5),e.Q6J("disabled",r.paymentFormValid&&!1))},dependencies:[Z.s,l.st,l.po]})}return i})();const re=["stepper"],ne=[{path:"",component:(()=>{class i{constructor(t,n,r){this.basketService=t,this.checkoutService=n,this.fb=r,this.orderForm=this.fb.group({addressForm:this.fb.group({street:["",[a.kI.required,a.kI.maxLength(100)]],city:["",[a.kI.required,a.kI.maxLength(100)]],state:["",[a.kI.required,a.kI.maxLength(100)]],zipcode:["",[a.kI.required,a.kI.maxLength(10),i=>i.value?(console.log(/^[0-9]*$/.test(i.value)?null:{numbers:"false"}),/^[0-9]*$/.test(i.value)?null:{numbers:"false"}):null]]}),deliveryForm:this.fb.group({deliveryMethodId:["",[a.kI.required]]}),paymentForm:this.fb.group({nameOnCard:["",[a.kI.required]]})}),this.shippingPrice=0,this.subtotal=0}ngOnInit(){this.loadProductDetails()}loadProductDetails(){this.basketService.getBasketDetails().pipe((0,f.q)(1)).subscribe(t=>{this.basketDetails=t,this.subtotal=t.basketProducts.reduce((n,r)=>n+r.price*r.quantity,0)})}updateCurrentDelivery(t){this.shippingPrice=t.price}createPaymentIntent(){const t={deliveryMethodId:this.orderForm.get("deliveryForm")?.value?.deliveryMethodId,items:this.basketDetails?.basketProducts.map(n=>({productId:n.productId,quantity:n.quantity}))};this.checkoutService.createPaymentIntent(t).subscribe({next:n=>{this.paymentIntent=n,this.stepper?.next()}})}static#e=this.\u0275fac=function(n){return new(n||i)(e.Y36(g.v),e.Y36(y),e.Y36(a.qu))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-checkout"]],viewQuery:function(n,r){if(1&n&&e.Gf(re,5),2&n){let s;e.iGM(s=e.CRH())&&(r.stepper=s.first)}},decls:36,vars:15,consts:[[1,"container"],[1,"mt-5","row"],[1,"col-8"],[3,"linearModeSelected"],["stepper",""],[3,"label"],[3,"addressForm"],[1,"d-flex","justify-content-between"],["routerLink","/basket",1,"btn","btn","btn-outline-primary"],[1,"fa","fa-angle-left","me-1"],["cdkStepperNext","",1,"btn","btn-primary",3,"disabled"],[1,"fa","fa-angle-right","ms-1"],[3,"deliveryForm","deliveryChanged"],["cdkStepperPrevious","",1,"btn","btn","btn-outline-primary"],[3,"basketDetails"],[1,"btn","btn-primary",3,"click"],[3,"paymentIntent","orderForm","basketDetails"],[1,"col-4"],[3,"subtotal","shipping"]],template:function(n,r){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-stepper",3,4)(5,"cdk-step",5),e._UZ(6,"app-checkout-address",6),e.TgZ(7,"div",7)(8,"button",8),e._UZ(9,"i",9),e._uU(10," back to basket"),e.qZA(),e.TgZ(11,"button",10),e._uU(12,"Next to delivery "),e._UZ(13,"i",11),e.qZA()()(),e.TgZ(14,"cdk-step",5)(15,"app-checkout-delivery",12),e.NdJ("deliveryChanged",function(d){return r.updateCurrentDelivery(d)}),e.qZA(),e.TgZ(16,"div",7)(17,"button",13),e._UZ(18,"i",9),e._uU(19," back to Address"),e.qZA(),e.TgZ(20,"button",10),e._uU(21,"Next to Review "),e._UZ(22,"i",11),e.qZA()()(),e.TgZ(23,"cdk-step",5),e._UZ(24,"app-checkout-review",14),e.TgZ(25,"div",7)(26,"button",13),e._UZ(27,"i",9),e._uU(28," back to Delivery"),e.qZA(),e.TgZ(29,"button",15),e.NdJ("click",function(){return r.createPaymentIntent()}),e._uU(30,"Next to Payment "),e._UZ(31,"i",11),e.qZA()()(),e.TgZ(32,"cdk-step",5),e._UZ(33,"app-checkout-payment",16),e.qZA()()(),e.TgZ(34,"div",17),e._UZ(35,"app-order-summary",18),e.qZA()()()),2&n&&(e.xp6(3),e.Q6J("linearModeSelected",!0),e.xp6(2),e.Q6J("label","Address"),e.xp6(1),e.Q6J("addressForm",r.orderForm.controls.addressForm),e.xp6(5),e.Q6J("disabled",r.orderForm.controls.addressForm.invalid),e.xp6(3),e.Q6J("label","Delivery"),e.xp6(1),e.Q6J("deliveryForm",r.orderForm.controls.deliveryForm),e.xp6(5),e.Q6J("disabled",r.orderForm.controls.deliveryForm.invalid),e.xp6(3),e.Q6J("label","Review"),e.xp6(1),e.Q6J("basketDetails",r.basketDetails),e.xp6(8),e.Q6J("label","Payment"),e.xp6(1),e.Q6J("paymentIntent",r.paymentIntent)("orderForm",r.orderForm)("basketDetails",r.basketDetails),e.xp6(2),e.Q6J("subtotal",r.subtotal)("shipping",r.shippingPrice))},dependencies:[u.rH,A.h,P,l.be,l.st,l.po,q,O,D,te],styles:[".mat-step-icon[_ngcontent-%COMP%]   .mat-step-icon-state-number[_ngcontent-%COMP%]   .mat-step-icon-selected[_ngcontent-%COMP%]{background-color:red}"]})}return i})(),data:{breadcrumb:{label:"checkout"}}},{path:"success",component:(()=>{class i{constructor(t){this.router=t,this.orderId=this.router.getCurrentNavigation()?.extras?.state?.orderId||0}static#e=this.\u0275fac=function(n){return new(n||i)(e.Y36(u.F0))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-checkout-success"]],decls:8,vars:1,consts:[[1,"container","mt-5"],[1,"fa","fa-check-circle","fa-5x","text-success"],[1,"mt-3"],["type","button",1,"btn","btn-primary","mt-2",3,"routerLink"]],template:function(n,r){1&n&&(e.TgZ(0,"div",0),e._UZ(1,"i",1),e.TgZ(2,"h2",2),e._uU(3,"Thank you, your order is confirmed"),e.qZA(),e.TgZ(4,"p"),e._uU(5,"Your order has not shipped yet, to see your order you can click the button below"),e.qZA(),e.TgZ(6,"button",3),e._uU(7,"View your order"),e.qZA()()),2&n&&(e.xp6(6),e.MGl("routerLink","/orders/",r.orderId,""))},dependencies:[u.rH]})}return i})(),data:{breadcrumb:{label:"success"}}}];let ie=(()=>{class i{static#e=this.\u0275fac=function(n){return new(n||i)};static#t=this.\u0275mod=e.oAB({type:i});static#r=this.\u0275inj=e.cJS({imports:[u.Bz.forChild(ne),u.Bz]})}return i})();var oe=c(6208);let se=(()=>{class i{static#e=this.\u0275fac=function(n){return new(n||i)};static#t=this.\u0275mod=e.oAB({type:i});static#r=this.\u0275inj=e.cJS({imports:[p.ez,ie,oe.m]})}return i})()}}]);